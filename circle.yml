
dependencies:
  pre:
    - curl https://install.meteor.com | /bin/sh
  post:
    # Work around bug where the first time we run test it fails on error related to
    # node-sass which I'm not even aware that we are using
    # Removing the node_modules directory seems to fix this issue such that
    # the second time the command runs it's ok
    - meteor run --test --settings settings/test.json || true
    - rm -rf node_modules

test:
  override:
    # Try single run and see if it makes test more reliable, inspiration from https://circleci.com/gh/bumbleblym/meteor-ci/3
    - JASMINE_SINGLE_RUN=1 JASMINE_BROWSER=PhantomJS meteor run --test --settings settings/test.json

deployment:
  dev:
    branch: master
    heroku:
      appname: ketch-dev
  beta:
    branch: beta
    heroku:
      appname: ketch-beta
  prod:
    branch: prod
    heroku:
      appname: ketch